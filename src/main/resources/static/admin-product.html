<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìƒí’ˆ ê´€ë¦¬ - ì‹¹ì“°ë¦¬ ê´€ë¦¬ì</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Apple SD Gothic Neo', sans-serif;
            background: #fafafa;
            min-height: 100vh;
        }

        header {
            background: #ffffff;
            padding: 20px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 24px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.08);
            position: sticky;
            top: 0;
            z-index: 100;
            border-bottom: 1px solid #f0f0f0;
        }

        .logo {
            font-size: 26px;
            font-weight: 700;
            background: linear-gradient(135deg, #74b9ff 0%, #a29bfe 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            cursor: pointer;
        }

        .header-title { flex: 1; font-size: 20px; font-weight: 600; color: #212529; display: flex; align-items: center; gap: 8px; }
        .header-icons { display: flex; gap: 12px; }

        .btn-common { padding: 10px 20px; border-radius: 12px; font-size: 14px; font-weight: 600; cursor: pointer; border: none; transition: 0.2s; }
        .home-btn { background: linear-gradient(135deg, #74b9ff 0%, #a29bfe 100%); color: white; box-shadow: 0 4px 12px rgba(116,185,255,0.3); }
        .home-btn:hover { opacity: 0.9; transform: translateY(-1px); }
        .logout-btn { background: #f8f9fa; color: #495057; }
        .logout-btn:hover { background: #e9ecef; }

        .container { max-width: 1400px; margin: 0 auto; padding: 40px 20px; }

        .page-header {
            background: linear-gradient(135deg, #74b9ff 0%, #a29bfe 100%);
            padding: 40px;
            border-radius: 24px;
            margin-bottom: 40px;
            color: white;
            box-shadow: 0 10px 40px rgba(116,185,255,0.25);
        }

        .tab-section { display: flex; gap: 12px; margin-bottom: 24px; }
        .tab-btn { padding: 12px 24px; border-radius: 12px; border: none; background: white; color: #495057; font-weight: 600; cursor: pointer; box-shadow: 0 2px 8px rgba(0,0,0,0.04); transition: 0.2s; }
        .tab-btn.active { background: #74b9ff; color: white; }

        /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
           í•„í„° ì„¹ì…˜: ì¹´í…Œê³ ë¦¬ + ìƒí’ˆ ë“±ë¡ ë²„íŠ¼
           â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .filter-section {
            background: white;
            padding: 20px 24px;
            border-radius: 16px;
            margin-bottom: 24px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.04);
            display: flex;
            gap: 16px;
            align-items: center;
        }
        .filter-section label { font-size: 14px; font-weight: 600; color: #495057; white-space: nowrap; }
        .filter-section select { width: 200px; padding: 10px 12px; border: 2px solid #e9ecef; border-radius: 10px; font-size: 14px; outline: none; cursor: pointer; }
        .filter-section select:focus { border-color: #74b9ff; }

        /* ì˜¤ë¥¸ìª½ ë ìƒí’ˆ ë“±ë¡ ë²„íŠ¼ */
        .filter-spacer { flex: 1; }

        /* ìƒí’ˆ ë“±ë¡ ë²„íŠ¼ íŒŒë€ìƒ‰ìœ¼ë¡œ ë³€ê²½ */
        .create-btn, .home-btn {
            background-color: #3498db !important; /* ë©”ì¸ íŒŒë€ìƒ‰ */
            color: white !important;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
        }

        .create-btn:hover, .home-btn:hover {
            background-color: #2980b9 !important;
        }

        /* ì‚­ì œ ë²„íŠ¼ ìŠ¤íƒ€ì¼ (ë¹¨ê°„ìƒ‰) */
        .delete-btn {
            background-color: #e74c3c !important;
            color: white !important;
            margin-right: auto; /* ì™¼ìª½ ëìœ¼ë¡œ ë°°ì¹˜ */
        }

        /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
           í…Œì´ë¸”
           â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .table-container { background: white; border-radius: 16px; box-shadow: 0 2px 8px rgba(0,0,0,0.04); overflow: hidden; }
        table { width: 100%; border-collapse: collapse; }
        th { background: #f8f9fa; padding: 16px 24px; text-align: left; font-size: 13px; color: #495057; border-bottom: 1px solid #e9ecef; }
        td { padding: 16px 24px; font-size: 14px; color: #495057; border-bottom: 1px solid #f0f0f0; vertical-align: middle; }
        tr:hover td { background: #f8f9fa; }
        tbody tr { cursor: pointer; }

        .status-badge { padding: 4px 12px; border-radius: 8px; font-size: 12px; font-weight: 600; }
        .status-BEFORE_SALE { background: #f3f0ff; color: #7950f2; }
        .status-FOR_SALE    { background: #e3f2fd; color: #1976d2; }
        .status-STOP_SALE   { background: #fff3e0; color: #e65100; }
        .status-SOLD_OUT    { background: #ffebee; color: #d32f2f; }
        .status-ACTIVE      { background: #e3f2fd; color: #1976d2; }

        /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
           í˜ì´ì§€ë„¤ì´ì…˜
           â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .pagination { display: flex; justify-content: center; align-items: center; padding: 24px; gap: 6px; flex-wrap: wrap; }
        .page-btn {
            min-width: 36px;
            height: 36px;
            padding: 0 10px;
            border-radius: 8px;
            border: 1px solid #e9ecef;
            cursor: pointer;
            background: #fff;
            color: #495057;
            font-size: 13px;
            font-weight: 500;
            transition: 0.15s;
        }
        .page-btn:hover { background: #f0f7ff; border-color: #74b9ff; }
        .page-btn.active { background: #74b9ff; color: white; border-color: #74b9ff; font-weight: 700; }
        .page-btn.nav { font-weight: 700; color: #74b9ff; }

        /* â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
           ê³µí†µ ëª¨ë‹¬
           â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center; }
        .modal.active { display: flex; }
        .modal-content { background: white; border-radius: 24px; padding: 32px; width: 90%; max-width: 620px; max-height: 90vh; overflow-y: auto; animation: slideUp 0.3s; }
        @keyframes slideUp { from { transform: translateY(30px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

        .modal-title { font-size: 20px; font-weight: 700; color: #212529; margin-bottom: 24px; }
        .form-group { margin-bottom: 16px; }
        .form-row { display: flex; gap: 16px; }
        .form-row .form-group { flex: 1; }
        label { display: block; margin-bottom: 8px; font-size: 13px; font-weight: 600; color: #495057; }
        input[type="text"], input[type="number"], select, textarea {
            width: 100%;
            padding: 11px 14px;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            font-size: 14px;
            outline: none;
            transition: border-color 0.15s;
            font-family: inherit;
        }
        input:focus, select:focus, textarea:focus { border-color: #74b9ff; }
        textarea { resize: vertical; min-height: 80px; }

        /* ì´ë¯¸ì§€ URL ì…ë ¥ë€ â€“ ì„ íƒì ì„ì„ í‘œì‹œ */
        .optional-label::after { content: ' (ì„ íƒ)'; font-weight: 400; color: #adb5bd; }

        .modal-footer { display: flex; justify-content: flex-end; gap: 12px; margin-top: 28px; }

        .empty-row td { text-align: center; padding: 40px; color: #adb5bd; }

        footer {
            background: #212529;
            color: #adb5bd;
            text-align: center;
            padding: 40px 20px;
            margin-top: 60px;
        }

        footer p {
            margin: 10px 0;
            font-size: 14px;
            line-height: 1.6;
        }

        footer p:first-child {
            color: white;
            font-weight: 600;
            font-size: 15px;
        }
    </style>
</head>
<body>

<header>
    <div class="logo" onclick="location.href='home.html'">SSAK3</div>
    <div class="header-icons">
        <button class="btn-common home-btn" onclick="location.href='mypage.html'">ë§ˆì´í˜ì´ì§€</button>
        <button class="btn-common logout-btn" id="logoutBtn">ë¡œê·¸ì•„ì›ƒ</button>
    </div>
</header>

<div class="container">
    <div class="page-header">
        <h1>ìƒí’ˆ ë°ì´í„° ê´€ë¦¬</h1>
        <p id="totalCountDisplay">ì „ì²´ ìƒí’ˆ 0ê°œ | ì‹¤ì‹œê°„ ì¬ê³ ë¥¼ ê´€ë¦¬í•˜ì„¸ìš”</p>
    </div>

    <div class="tab-section">
        <button class="tab-btn active">ğŸ“¦ ìƒí’ˆ ê´€ë¦¬</button>
        <button class="tab-btn" onclick="location.href='admin-timedeal.html'">âš¡ íƒ€ì„ë”œ ê´€ë¦¬</button>
    </div>

    <!-- í•„í„° + ìƒí’ˆ ë“±ë¡ ë²„íŠ¼ -->
    <div class="filter-section">
        <label>ì¹´í…Œê³ ë¦¬</label>
        <select id="categoryFilter" onchange="loadProducts(0)">
            <option value="">ì „ì²´ ì¹´í…Œê³ ë¦¬</option>
        </select>
        <div class="filter-spacer"></div>
        <button class="create-btn" onclick="openCreateModal()">+ ìƒí’ˆ ë“±ë¡</button>
    </div>

    <div class="table-container">
        <table>
            <thead>
            <tr>
                <th>ID</th>
                <th>ìƒí’ˆ ì •ë³´</th>
                <th>ì¹´í…Œê³ ë¦¬</th>
                <th>ê°€ê²©</th>
                <th>ì¬ê³ </th>
                <th>ìƒíƒœ</th>
                <th>ë“±ë¡ì¼</th>
            </tr>
            </thead>
            <tbody id="productTableBody">
            <tr class="empty-row"><td colspan="7">ë¡œë”© ì¤‘...</td></tr>
            </tbody>
        </table>
        <div id="pagination" class="pagination"></div>
    </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     ìƒí’ˆ ë“±ë¡ ëª¨ë‹¬
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="modal" id="productCreateModal">
    <div class="modal-content">
        <div class="modal-title">ğŸ“¦ ìƒí’ˆ ë“±ë¡</div>

        <div class="form-group">
            <label>ì¹´í…Œê³ ë¦¬ <span style="color:#e74c3c">*</span></label>
            <select id="createCategorySelect">
                <option value="">ì¹´í…Œê³ ë¦¬ ì„ íƒ</option>
            </select>
        </div>

        <div class="form-group">
            <label>ìƒí’ˆëª… <span style="color:#e74c3c">*</span></label>
            <input type="text" id="createName" placeholder="ìƒí’ˆëª…ì„ ì…ë ¥í•˜ì„¸ìš”">
        </div>

        <div class="form-row">
            <div class="form-group">
                <label>ê°€ê²© (ì›) <span style="color:#e74c3c">*</span></label>
                <input type="number" id="createPrice" placeholder="0" min="0">
            </div>
            <div class="form-group">
                <label>ì¬ê³  ìˆ˜ëŸ‰ <span style="color:#e74c3c">*</span></label>
                <input type="number" id="createQuantity" placeholder="0" min="0">
            </div>
        </div>

        <div class="form-group">
            <label>ìƒí’ˆ ì„¤ëª…</label>
            <textarea id="createInformation" placeholder="ìƒí’ˆ ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
        </div>

        <div class="form-group">
            <label>ëŒ€í‘œ ì´ë¯¸ì§€</label>
            <input type="file" id="createImageFile" accept="image/*">
        </div>

        <div class="form-group">
            <label>ìƒì„¸ ì´ë¯¸ì§€</label>
            <input type="file" id="createDetailImageFile" accept="image/*">
        </div>

        <div class="modal-footer">
            <button class="btn-common logout-btn" onclick="closeCreateModal()">ì·¨ì†Œ</button>
            <button class="btn-common home-btn" onclick="createProduct()">ë“±ë¡í•˜ê¸°</button>
        </div>
    </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     ìƒí’ˆ ìˆ˜ì • ëª¨ë‹¬
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="modal" id="editModal">
    <div class="modal-content">
        <div class="modal-title">âœï¸ ìƒí’ˆ ìƒì„¸ / ìˆ˜ì •</div>

        <div class="form-group">
            <label>ì¹´í…Œê³ ë¦¬</label>
            <select id="editCategorySelect">
                <option value="">ì¹´í…Œê³ ë¦¬ ì„ íƒ</option>
            </select>
        </div>

        <div class="form-group">
            <label>ìƒí’ˆëª…</label>
            <input type="text" id="editName" placeholder="ìƒí’ˆëª…">
        </div>

        <div class="form-row">
            <div class="form-group">
                <label>ê°€ê²© (ì›)</label>
                <div style="display: flex; gap: 8px;">
                    <button type="button" class="btn-common logout-btn" onclick="adjustPrice(-1000)" style="padding: 10px;">-1000</button>
                    <input type="number" id="editPrice" min="0" step="1000" placeholder="0" style="flex: 1;">
                    <button type="button" class="btn-common logout-btn" onclick="adjustPrice(1000)" style="padding: 10px;">+1000</button>
                </div>
            </div>
            <div class="form-group">
                <label>ì¬ê³  ìˆ˜ëŸ‰</label>
                <input type="number" id="editQuantity" min="0">
            </div>
        </div>

        <div class="form-group">
            <label>ìƒí’ˆ ì„¤ëª…</label>
            <textarea id="editInformation" placeholder="ìƒí’ˆ ì„¤ëª…"></textarea>
        </div>

        <div class="form-group">
            <label>íŒë§¤ ìƒíƒœ</label>
            <select id="editStatus">
                <option value="BEFORE_SALE">íŒë§¤ì „</option>
                <option value="FOR_SALE">íŒë§¤ì¤‘</option>
                <option value="STOP_SALE">íŒë§¤ì¤‘ì§€</option>
                <option value="SOLD_OUT">í’ˆì ˆ</option>
            </select>
        </div>

        <div class="form-group">
            <label class="optional-label">ëŒ€í‘œ ì´ë¯¸ì§€ ë³€ê²½</label>
            <input type="file" id="editImageFile" accept="image/*">
        </div>

        <div class="form-group">
            <label class="optional-label">ìƒì„¸ ì´ë¯¸ì§€ ë³€ê²½</label>
            <input type="file" id="editDetailImageFile" accept="image/*">
        </div>


        <div class="modal-footer">
            <button class="btn-common logout-btn" onclick="closeEditModal()">ì·¨ì†Œ</button>
            <button class="btn-common delete-btn" onclick="deleteProduct()">ì‚­ì œí•˜ê¸°</button>
            <button class="btn-common home-btn" onclick="updateProduct()">ìˆ˜ì •í•˜ê¸°</button>
        </div>
    </div>
</div>

<footer>
    <p>Â© ì‹¹ì“°ë¦¬ - ëª¨ë‘ë¥¼ ìœ„í•œ ê·€ì—¬ìš´ êµ¿ì¦ˆ</p>
    <p>ê³ ê°ì„¼í„°: 010-1234-5678 | <a href="https://github.com/thk7964/Ssak3" class="__cf_email__">ì‹¹ì“°ë¦¬ í™ˆí˜ì´ì§€</a></p>
    <p>ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨ | ì´ìš©ì•½ê´€ | ë°°ì†¡ì •ì±…</p>
</footer>

<script>
    // API URL ì„¤ì •
    const API_URL = (() => {
        const hostname = window.location.hostname;

        if (hostname === 'localhost' || hostname === '127.0.0.1') {
            return 'http://localhost:8080';
        }

        if (hostname === 'admin.ssak3.store') {
            return 'https://admin.ssak3.store';
        }

        return 'https://ssak3.store';
    })();

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // ì „ì—­ ìƒíƒœ
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    let currentId   = null;
    let currentPage = 0;
    const PAGE_GROUP_SIZE = 10;

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // ì§„ì…ì 
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    document.addEventListener('DOMContentLoaded', () => {
        loadCategories();
        loadProducts(0);
    });

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // ê³µí†µ fetch ì˜µì…˜
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function getRequestOptions(method = 'GET', body = null) {
        const token = localStorage.getItem('accessToken');
        const headers = { 'Content-Type': 'application/json' };
        if (token && token !== 'null' && token !== 'undefined') {
            headers['Authorization'] = `Bearer ${token}`;
        }
        const options = { method, headers, credentials: 'include' };
        if (body !== null) options.body = JSON.stringify(body);
        return options;
    }

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // ì¹´í…Œê³ ë¦¬ ë¡œë“œ (í•„í„° select + ë“±ë¡/ìˆ˜ì • ëª¨ë‹¬ select ë™ê¸°í™”)
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // ì¹´í…Œê³ ë¦¬ ë¡œë“œ í•¨ìˆ˜ ìˆ˜ì • (ìˆ˜ì • ì „: result?.data?.content)
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // ì¹´í…Œê³ ë¦¬ ë¡œë“œ í•¨ìˆ˜ ìˆ˜ì • (ìµœì‹ ìˆœ ì •ë ¬ ì¶”ê°€)
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    async function loadCategories() {
        try {
            const res = await fetch(`${API_URL}/ssak3/categories`, getRequestOptions());
            const result = await res.json();

            // 1. ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
            let categories = result?.data || [];

            // 2. ìµœì‹ ìˆœ ì •ë ¬ (IDê°€ í´ìˆ˜ë¡ ìµœì‹ ì´ë¼ê³  ê°€ì •í•  ë•Œ ì—­ìˆœ ì •ë ¬)
            // ë§Œì•½ ìƒì„±ì¼(createdAt)ë¡œ ì •ë ¬í•˜ê³  ì‹¶ë‹¤ë©´:
            // categories.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
            categories.sort((a, b) => b.id - a.id);

            console.log('âœ… ìµœì‹ ìˆœ ì •ë ¬ëœ ì¹´í…Œê³ ë¦¬:', categories);

            const optionsHtml = categories.map(c =>
                `<option value="${c.id}">${c.name}</option>`
            ).join('');

            const filterEl = document.getElementById('categoryFilter');
            if (filterEl) filterEl.innerHTML = '<option value="">ì „ì²´ ì¹´í…Œê³ ë¦¬</option>' + optionsHtml;

            const createEl = document.getElementById('createCategorySelect');
            if (createEl) createEl.innerHTML = '<option value="">ì¹´í…Œê³ ë¦¬ ì„ íƒ</option>' + optionsHtml;

            const editEl = document.getElementById('editCategorySelect');
            if (editEl) editEl.innerHTML = '<option value="">ì¹´í…Œê³ ë¦¬ ì„ íƒ</option>' + optionsHtml;

        } catch (err) {
            console.error('ì¹´í…Œê³ ë¦¬ ë¡œë”© ì‹¤íŒ¨:', err);
        }
    }

    async function loadProducts(page = 0) {
        const categoryFilter = document.getElementById('categoryFilter');
        const rawValue = categoryFilter ? categoryFilter.value : "";

        let url = `${API_URL}/ssak3/admin/products?page=${page}&size=10`;

        if (rawValue !== "" && rawValue !== null && rawValue !== "null") {
            const cleanId = parseInt(rawValue, 10);
            if (!isNaN(cleanId)) {
                url += `&categoryId=${cleanId}`;
            }
        }

        try {
            const response = await fetch(url, getRequestOptions());

            // ì‘ë‹µì´ ì„±ê³µì´ ì•„ë‹ ë•Œ (400, 404, 500 ë“±)
            if (!response.ok) {
                const errorBody = await response.json();
                const msg = errorBody.message || "";
                const code = errorBody.errorCode || "";

                // ğŸ’¡ 6ë²ˆ ì¹´í…Œê³ ë¦¬ ë“± íŠ¹ì • ìƒí™©ì— ëŒ€í•œ ì—ëŸ¬ ë©”ì‹œì§€ ì¹˜í™˜
                if (code === 'INVALID_URL' || msg.includes('ìœ íš¨í•˜ì§€ ì•Šì€ url')) {
                    alert('ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ì¹´í…Œê³ ë¦¬ì…ë‹ˆë‹¤.');
                } else {
                    alert(`ìƒí’ˆ ë¡œë“œ ì‹¤íŒ¨: ${msg || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'}`);
                }
                return;
            }

            const result = await response.json();
            const pageData = result.data;
            if (!pageData) return;

            currentPage = page;
            renderTable(pageData.content ?? []);
            renderPagination(pageData);

            document.getElementById('totalCountDisplay').innerText =
                `ì „ì²´ ìƒí’ˆ ${pageData.totalElements ?? 0}ê°œ | ì‹¤ì‹œê°„ ê´€ë¦¬ ì¤‘`;

        } catch (err) {
            console.error('ìƒí’ˆ ëª©ë¡ ë¡œë”© ì‹¤íŒ¨:', err);
            alert('ì„œë²„ì™€ í†µì‹  ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        }
    }

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // í…Œì´ë¸” ë Œë”ë§
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function renderTable(products) {
        const tbody = document.getElementById('productTableBody');
        if (!tbody) return;

        if (products.length === 0) {
            tbody.innerHTML = '<tr class="empty-row"><td colspan="7">ìƒí’ˆì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
            return;
        }

        tbody.innerHTML = products.map(p => {
            const img = p.imageUrl
                ? `<img src="${p.imageUrl}" width="32" height="32" style="border-radius:6px;object-fit:cover;vertical-align:middle;margin-right:8px;" onerror="this.style.display='none'">`
                : '<span style="margin-right:8px;">ğŸ“¦</span>';

            const statusLabel = {
                BEFORE_SALE: 'íŒë§¤ì „',
                FOR_SALE:    'íŒë§¤ì¤‘',
                STOP_SALE:   'íŒë§¤ì¤‘ì§€',
                SOLD_OUT:    'í’ˆì ˆ'
            }[p.status] ?? p.status;

            return `
            <tr onclick="openEditModal(${p.id})">
                <td>${p.id}</td>
                <td>${img}<span style="font-weight:600">${p.name ?? 'ì´ë¦„ ì—†ìŒ'}</span></td>
                <td>${p.categoryName ?? '-'}</td>
                <td>${(p.price ?? 0).toLocaleString()}ì›</td>
                <td>${p.quantity ?? 0}ê°œ</td>
                <td><span class="status-badge status-${p.status}">${statusLabel}</span></td>
                <td>${p.createdAt ? p.createdAt.substring(0, 10) : '-'}</td>
            </tr>`;
        }).join('');
    }

    function renderPagination(data) {
        const container = document.getElementById('pagination');
        if (!container) return;

        const totalPages = data.totalPages ?? 0;
        const current    = currentPage;
        const groupStart = Math.floor(current / PAGE_GROUP_SIZE) * PAGE_GROUP_SIZE;
        const groupEnd   = Math.min(groupStart + PAGE_GROUP_SIZE, totalPages);

        if (totalPages <= 1) { container.innerHTML = ''; return; }

        let html = '';

        // ì²« í˜ì´ì§€ ë²„íŠ¼ (í˜„ì¬ í˜ì´ì§€ê°€ 0ì´ ì•„ë‹ ë•Œë§Œ í‘œì‹œ)
        if (current > 0) {
            html += `<button class="page-btn nav" onclick="loadProducts(0)">ì²˜ìŒ</button>`;
        }

        // -10 ë²„íŠ¼ (í˜„ì¬ í˜ì´ì§€ê°€ 10 ì´ìƒì¼ ë•Œë§Œ í‘œì‹œ)
        if (current >= 10) {
            html += `<button class="page-btn nav" onclick="loadProducts(${current - 10})">-10</button>`;
        }

        // ì´ì „ ë²„íŠ¼ (í˜„ì¬ í˜ì´ì§€ê°€ 0ë³´ë‹¤ í´ ë•Œë§Œ í‘œì‹œ, í•œ í˜ì´ì§€ì”© ì´ë™)
        if (current > 0) {
            html += `<button class="page-btn nav" onclick="loadProducts(${current - 1})">ì´ì „</button>`;
        }

        // ìˆ«ì ë²„íŠ¼ë“¤
        for (let i = groupStart; i < groupEnd; i++) {
            const activeClass = (i === current) ? 'active' : '';
            html += `<button class="page-btn ${activeClass}" onclick="loadProducts(${i})">${i + 1}</button>`;
        }

        // ë‹¤ìŒ ë²„íŠ¼ (í˜„ì¬ í˜ì´ì§€ê°€ ë§ˆì§€ë§‰ í˜ì´ì§€ê°€ ì•„ë‹ ë•Œë§Œ í‘œì‹œ, í•œ í˜ì´ì§€ì”© ì´ë™)
        if (current < totalPages - 1) {
            html += `<button class="page-btn nav" onclick="loadProducts(${current + 1})">ë‹¤ìŒ</button>`;
        }

        // +10 ë²„íŠ¼ (í˜„ì¬ í˜ì´ì§€ + 10ì´ ì´ í˜ì´ì§€ ìˆ˜ë³´ë‹¤ ì‘ì„ ë•Œë§Œ í‘œì‹œ)
        if (current + 10 < totalPages) {
            html += `<button class="page-btn nav" onclick="loadProducts(${current + 10})">+10</button>`;
        }

        // ë§ˆì§€ë§‰ í˜ì´ì§€ ë²„íŠ¼ (í˜„ì¬ í˜ì´ì§€ê°€ ë§ˆì§€ë§‰ í˜ì´ì§€ê°€ ì•„ë‹ ë•Œë§Œ í‘œì‹œ)
        if (current < totalPages - 1) {
            html += `<button class="page-btn nav" onclick="loadProducts(${totalPages - 1})">ë</button>`;
        }

        container.innerHTML = html;
    }

    // [9] ìƒí’ˆ ì‚­ì œ ì‹¤í–‰
    async function deleteProduct() {
        if (!currentId) return;

        if (!confirm("ì •ë§ë¡œ ì´ ìƒí’ˆì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")) {
            return;
        }

        try {
            const res = await fetch(`${API_URL}/ssak3/admin/products/${currentId}`,
                getRequestOptions('DELETE'));

            if (res.ok) {
                alert('ìƒí’ˆì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤. ğŸ—‘ï¸');
                closeEditModal();
                loadProducts(currentPage);
            } else {
                const err = await res.json().catch(() => ({}));
                alert(`ì‚­ì œ ì‹¤íŒ¨: ${err.message ?? 'ê¶Œí•œì´ ì—†ê±°ë‚˜ ì´ë¯¸ ì‚­ì œëœ ìƒí’ˆì…ë‹ˆë‹¤.'}`);
            }
        } catch (e) {
            console.error('ì‚­ì œ ì¤‘ ì˜¤ë¥˜:', e);
            alert('ì„œë²„ì™€ì˜ í†µì‹  ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        }
    }

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // ìƒí’ˆ ë“±ë¡ ëª¨ë‹¬ ì—´ê¸° (ì—ëŸ¬ ìˆ˜ì •ë¨)
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function openCreateModal() {
        // 1. í…ìŠ¤íŠ¸ ì…ë ¥ê°’ ì´ˆê¸°í™”
        document.getElementById('createCategorySelect').value = '';
        document.getElementById('createName').value = '';
        document.getElementById('createPrice').value = '';
        document.getElementById('createQuantity').value = '';
        document.getElementById('createInformation').value = '';

        // 2. íŒŒì¼ ì…ë ¥ê°’ ì´ˆê¸°í™” (ê¸°ì¡´ createImageUrl ëŒ€ì‹  íŒŒì¼ ID ì‚¬ìš©)
        const mainFileInput = document.getElementById('createImageFile');
        const detailFileInput = document.getElementById('createDetailImageFile');

        if (mainFileInput) mainFileInput.value = '';
        if (detailFileInput) detailFileInput.value = '';

        document.getElementById('productCreateModal').classList.add('active');
    }

    function closeCreateModal() {
        document.getElementById('productCreateModal').classList.remove('active');
    }

    // 1. Presigned URL ë°œê¸‰ ìš”ì²­ (Query Parameter ë°©ì‹)
    async function issuePresignedPut({ baseUrl, dirName, file }) {
        if (!file) throw new Error("íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤.");

        // URL ìƒì„± ì‹œ baseUrl ëì— /ê°€ ìˆëŠ”ì§€ í™•ì¸í•˜ì—¬ ì¤‘ë³µ ë°©ì§€
        const cleanBaseUrl = baseUrl.replace(/\/+$/, "");
        const url = new URL(`${cleanBaseUrl}/admin/images/presigned`);

        // @RequestParamì— ëŒ€ì‘í•˜ê¸° ìœ„í•´ searchParams ì‚¬ìš©
        url.searchParams.set("dirName", dirName);
        url.searchParams.set("fileName", file.name);

        console.log("ìš”ì²­ URL:", url.toString()); // ë””ë²„ê¹…ìš©

        const res = await fetch(url.toString(), getRequestOptions("POST"));

        if (!res.ok) {
            const errorData = await res.json().catch(() => ({}));
            throw new Error(`Presigned ë°œê¸‰ ì‹¤íŒ¨: ${errorData.message || res.status}`);
        }

        const json = await res.json();
        return json.data; // uploadUrl, imageUrl í¬í•¨
    }

    // 2. S3ì— ì‹¤ì œ íŒŒì¼ ì—…ë¡œë“œ (PUT ë°©ì‹)
    async function putToS3(uploadUrl, file) {
        const res = await fetch(uploadUrl, {
            method: "PUT",
            body: file,
            headers: {
                "Content-Type": file.type // S3 ì„œëª… ì¼ì¹˜ë¥¼ ìœ„í•´ ì»¨í…ì¸  íƒ€ì… ëª…ì‹œ
            }
        });

        if (!res.ok) {
            throw new Error("S3 ì‹¤ì œ ì—…ë¡œë“œ ì‹¤íŒ¨");
        }
    }

    // 3. ìƒí’ˆ ë“±ë¡ í†µí•© ë¡œì§
    async function createProduct() {
        const baseUrl = `${API_URL}/ssak3`.replace(/\/+$/, "");

        // DOM ìš”ì†Œ ê°€ì ¸ì˜¤ê¸°
        const categoryId = Number(document.getElementById("createCategorySelect").value);
        const name = document.getElementById("createName").value.trim();
        const price = Number(document.getElementById("createPrice").value);
        const quantity = Number(document.getElementById("createQuantity").value);
        const information = document.getElementById("createInformation").value;

        const imageFile = document.getElementById("createImageFile").files?.[0] ?? null;
        const detailFile = document.getElementById("createDetailImageFile").files?.[0] ?? null;

        if (!categoryId || !name) {
            alert("ì¹´í…Œê³ ë¦¬ì™€ ìƒí’ˆëª…ì€ í•„ìˆ˜ì…ë‹ˆë‹¤.");
            return;
        }

        if (quantity < 0) {
            alert("ì¬ê³ ëŠ” 0 ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.");
            return;
        }

        try {
            let imageUrl = null;
            let detailImageUrl = null;

            // ğŸ”¥ ëŒ€í‘œ ì´ë¯¸ì§€ ì—…ë¡œë“œ
            if (imageFile) {
                const presigned = await issuePresignedPut({ baseUrl, dirName: "products", file: imageFile });
                await putToS3(presigned.uploadUrl, imageFile);
                imageUrl = presigned.imageUrl;
            }

            // ğŸ”¥ ìƒì„¸ ì´ë¯¸ì§€ ì—…ë¡œë“œ
            if (detailFile) {
                const presigned = await issuePresignedPut({ baseUrl, dirName: "products/details", file: detailFile });
                await putToS3(presigned.uploadUrl, detailFile);
                detailImageUrl = presigned.imageUrl;
            }

            // ë°±ì—”ë“œ ìƒí’ˆ ìƒì„± API í˜¸ì¶œ
            const payload = {
                categoryId,
                name,
                price,
                status,
                information,
                quantity
            };

            // â­ ì´ë¯¸ì§€ ì„ íƒí–ˆì„ ë•Œë§Œ í•„ë“œ ì¶”ê°€
            if (imageUrl !== null) {
                payload.image = imageUrl;
            }

            if (detailImageUrl !== null) {
                payload.detailImage = detailImageUrl;
            }


            const res = await fetch(`${baseUrl}/admin/products`, getRequestOptions("POST", payload));

            if (!res.ok) {
                const err = await res.json().catch(() => ({}));
                throw new Error(err.message || "ìƒí’ˆ ìƒì„± ì‹¤íŒ¨");
            }

            alert("ìƒí’ˆ ë“±ë¡ ì„±ê³µ ğŸ‰");
            closeCreateModal();
            loadProducts(0); // ì²« í˜ì´ì§€ë¡œ ìƒˆë¡œê³ ì¹¨

        } catch (e) {
            console.error("ë“±ë¡ ì¤‘ ì—ëŸ¬ ë°œìƒ:", e);
            alert("ì—ëŸ¬: " + e.message);
        }
    }

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // ìƒí’ˆ ìˆ˜ì • ëª¨ë‹¬ ì—´ê¸°
    // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    // 1. í•¨ìˆ˜ ë°– ìµœìƒë‹¨ì— ì „ì—­ ë³€ìˆ˜ ì„ ì–¸ (ì´ë¯¸ ì„ ì–¸ë˜ì–´ ìˆë‹¤ë©´ ìœ ì§€)
    let currentImageUrl = "";
    let currentDetailImageUrl = "";

    async function openEditModal(id) {
        currentId = id;

        try {
            const res    = await fetch(`${API_URL}/ssak3/admin/products/${id}`, getRequestOptions());
            const result = await res.json();

            if (!result?.data) {
                console.error('ìƒí’ˆ ìƒì„¸ ë°ì´í„°ë¥¼ ë°›ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.');
                return;
            }

            const p = result.data;

            currentImageUrl = p.image;
            currentDetailImageUrl = p.detailImage;

            // ì¹´í…Œê³ ë¦¬ select ë™ê¸°í™”
            document.getElementById('editCategorySelect').value = p.categoryId  ?? '';
            document.getElementById('editName').value           = p.name        ?? '';
            document.getElementById('editPrice').value          = p.price       ?? 0;
            document.getElementById('editQuantity').value       = p.quantity    ?? 0;
            document.getElementById('editInformation').value    = p.information ?? '';
            document.getElementById('editStatus').value         = p.status      ?? 'BEFORE_SALE';

            // íŒŒì¼ ì„ íƒì°½ ì´ˆê¸°í™” (ë¸Œë¼ìš°ì € ë³´ì•ˆìƒ íŒŒì¼ëª…ì€ ì±„ìš¸ ìˆ˜ ì—†ìŒ)
            document.getElementById('editImageFile').value = '';
            document.getElementById('editDetailImageFile').value = '';

            document.getElementById('editModal').classList.add('active');
        } catch (e) {
            console.error('ìƒì„¸ ì¡°íšŒ ì¤‘ ì˜¤ë¥˜:', e);
            alert('ìƒì„¸ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        }
    }

    function closeEditModal() {
        document.getElementById('editModal').classList.remove('active');
    }

    function adjustPrice(amount) {
        const priceInput = document.getElementById('editPrice');
        let currentPrice = parseInt(priceInput.value) || 0;

        // ìƒˆë¡œìš´ ê°€ê²© ê³„ì‚° (ìµœì†Œ 0ì› ë³´ì¥)
        let newPrice = Math.max(0, currentPrice + amount);

        priceInput.value = newPrice;
    }

    async function updateProduct() {
        if (!currentId) return;

        // 1. í˜„ì¬ ì „ì—­ ë³€ìˆ˜ì— ê°’ì´ ìˆëŠ”ì§€ í™•ì¸ (ì—†ë‹¤ë©´ ëª¨ë‹¬ ì—´ ë•Œ ì €ì¥ ì•ˆ ëœ ê²ƒ)
        console.log("ê¸°ì¡´ ì´ë¯¸ì§€ URL í™•ì¸:", currentImageUrl);

        const baseUrl = `${API_URL}/ssak3`.replace(/\/+$/, "");
        const imageFile = document.getElementById("editImageFile").files?.[0] ?? null;
        const detailFile = document.getElementById("editDetailImageFile").files?.[0] ?? null;

        let finalImageUrl = currentImageUrl;
        let finalDetailImageUrl = currentDetailImageUrl;

        try {
            if (imageFile) {
                const presigned = await issuePresignedPut({ baseUrl, dirName: "products", file: imageFile });
                await putToS3(presigned.uploadUrl, imageFile);
                finalImageUrl = presigned.imageUrl;
            }

            if (detailFile) {
                const presigned = await issuePresignedPut({ baseUrl, dirName: "products/details", file: detailFile });
                await putToS3(presigned.uploadUrl, detailFile);
                finalDetailImageUrl = presigned.imageUrl;
            }

            const payload = {
                categoryId: Number(document.getElementById('editCategorySelect').value) || null,
                name: document.getElementById('editName').value.trim(),
                price: parseInt(document.getElementById('editPrice').value) || 0,
                status: document.getElementById('editStatus').value,
                information: document.getElementById('editInformation').value.trim() || null,
                quantity: parseInt(document.getElementById('editQuantity').value) || 0,
                image: finalImageUrl,
                detailImage: finalDetailImageUrl
            };

            // ì „ì†¡ ì§ì „ ë°ì´í„°ë¥¼ í™•ì¸í•´ë³´ì„¸ìš”. imageê°€ nullì¸ì§€ ì•„ë‹Œì§€ê°€ í•µì‹¬!
            console.log("ìµœì¢… ì „ì†¡ Payload:", payload);

            const res = await fetch(`${baseUrl}/admin/products/${currentId}`,
                getRequestOptions("PATCH", payload));

            if (res.ok) {
                alert("ìƒí’ˆ ìˆ˜ì • ì„±ê³µ ğŸ‰");
                closeEditModal();
                loadProducts(currentPage);
            } else {
                const err = await res.json();
                console.error("ì„œë²„ ì‘ë‹µ ì—ëŸ¬:", err);
                throw new Error(err.message || "ìˆ˜ì • ì‹¤íŒ¨");
            }
        } catch (e) {
            alert("ì—ëŸ¬: " + e.message);
        }
    }

    // ë¡œê·¸ì•„ì›ƒ
    document.getElementById('logoutBtn')?.addEventListener('click', () => {
        localStorage.removeItem('accessToken');
        location.href = 'login.html';
    });
</script>
</body>
</html>