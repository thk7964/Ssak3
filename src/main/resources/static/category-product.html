<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì¹´í…Œê³ ë¦¬ ìƒí’ˆ - ì‹¹ì“°ë¦¬</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Apple SD Gothic Neo', sans-serif;
            background: #fafafa;
            min-height: 100vh;
            color: #222;
        }

        /* â”€â”€ HEADER (home.html ìŠ¤íƒ€ì¼) â”€â”€ */
        header {
            width: 100%;
            background: rgba(255, 255, 255, 0.92);
            backdrop-filter: blur(12px);
            border-bottom: 1px solid rgba(255,255,255,0.5);
            box-shadow: 0 2px 16px rgba(116, 185, 255, 0.15);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-inner {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 28px;
            height: 64px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 16px;
        }

        .logo {
            font-size: 22px;
            font-weight: 800;
            background: linear-gradient(135deg, #74b9ff 0%, #a29bfe 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            letter-spacing: -0.5px;
            cursor: pointer;
            flex-shrink: 0;
            text-decoration: none;
        }

        .header-search {
            flex: 1;
            max-width: 400px;
            margin: 0 20px;
            display: flex;
            align-items: center;
            background: #f3f4f6;
            border-radius: 10px;
            border: 1.5px solid transparent;
            overflow: hidden;
            transition: all 0.15s ease;
        }

        .header-search:focus-within {
            background: white;
            border-color: #a29bfe;
            box-shadow: 0 0 0 3px rgba(162, 155, 254, 0.12);
        }

        .header-search input {
            flex: 1;
            border: none;
            background: transparent;
            padding: 9px 14px;
            font-size: 14px;
            color: #374151;
            outline: none;
        }

        .header-search input::placeholder {
            color: #9ca3af;
        }

        .header-search-btn {
            border: none;
            background: transparent;
            padding: 9px 14px;
            font-size: 13px;
            font-weight: 600;
            color: #a29bfe;
            cursor: pointer;
            white-space: nowrap;
            transition: color 0.15s ease;
            border-left: 1.5px solid #e5e7eb;
        }

        .header-search-btn:hover {
            color: #74b9ff;
        }

        .header-nav {
            display: flex;
            align-items: center;
            gap: 8px;
            flex-shrink: 0;
        }

        .navbar-link {
            padding: 8px 16px;
            color: #4b5563;
            font-size: 14px;
            font-weight: 500;
            border-radius: 8px;
            cursor: pointer;
            text-decoration: none;
            transition: all 0.15s ease;
            border: none;
            background: transparent;
            white-space: nowrap;
        }

        .navbar-link:hover {
            color: #74b9ff;
            background: rgba(116, 185, 255, 0.08);
        }

        .navbar-link.active {
            color: #a29bfe;
            font-weight: 700;
        }

        .navbar-divider {
            width: 1px;
            height: 18px;
            background: #e5e7eb;
            margin: 0 4px;
        }

        .auth-btn {
            padding: 8px 16px;
            color: #4b5563;
            font-size: 14px;
            font-weight: 500;
            border-radius: 8px;
            cursor: pointer;
            text-decoration: none;
            transition: all 0.15s ease;
            border: none;
            background: transparent;
            white-space: nowrap;
        }

        .auth-btn:hover {
            color: #74b9ff;
            background: rgba(116, 185, 255, 0.08);
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .user-info .navbar-link {
            color: #000000;
        }

        .logout-btn {
            padding: 8px 16px;
            color: #ef4444;
            font-size: 14px;
            font-weight: 500;
            border-radius: 8px;
            cursor: pointer;
            text-decoration: none;
            transition: all 0.15s ease;
            border: none;
            background: transparent;
            white-space: nowrap;
        }

        .logout-btn:hover {
            background: rgba(239, 68, 68, 0.08);
        }

        /* â”€â”€ PAGE HERO â”€â”€ */
        .page-hero {
            background: linear-gradient(135deg, #74b9ff 0%, #a29bfe 100%);
            padding: 50px 40px;
            margin: 24px 20px;
            border-radius: 24px;
            box-shadow: 0 10px 40px rgba(116,185,255,0.25);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
            overflow: hidden;
        }

        .page-hero::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            animation: rotate 20s linear infinite;
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to   { transform: rotate(360deg); }
        }

        .hero-text {
            position: relative;
        }

        .hero-text h1 {
            font-size: 36px;
            font-weight: 800;
            color: white;
            letter-spacing: -1px;
            margin-bottom: 8px;
        }

        .hero-text p {
            font-size: 15px;
            color: rgba(255,255,255,0.85);
        }

        .hero-count {
            position: relative;
            text-align: center;
            background: rgba(255,255,255,0.2);
            border-radius: 16px;
            padding: 18px 28px;
            backdrop-filter: blur(8px);
        }

        .count-num {
            font-size: 36px;
            font-weight: 800;
            color: white;
            display: block;
        }

        .count-label {
            font-size: 14px;
            color: rgba(255,255,255,0.85);
            margin-top: 4px;
        }

        /* â”€â”€ CATEGORY NAV â”€â”€ */
        nav,
        #categoryNav {
            display: flex;
            justify-content: center;
            gap: 8px;
            padding: 20px;
            flex-wrap: wrap;
            background: white;
            margin: 0 20px;
            border-radius: 16px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.04);
        }

        nav a,
        #categoryNav a {
            text-decoration: none;
            color: #495057;
            font-weight: 500;
            font-size: 14px;
            padding: 10px 18px;
            border-radius: 12px;
            transition: all 0.2s ease;
            cursor: pointer;
            background: #f8f9fa;
        }

        nav a:hover,
        #categoryNav a:hover {
            background: linear-gradient(135deg, #74b9ff 0%, #a29bfe 100%);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(116,185,255,0.35);
        }

        nav a.active,
        #categoryNav a.active {
            background: linear-gradient(135deg, #74b9ff 0%, #a29bfe 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(116,185,255,0.35);
        }

        /* â”€â”€ TOOLBAR â”€â”€ */
        .toolbar {
            max-width: 1200px;
            margin: 32px auto 0;
            padding: 0 20px;
        }

        .section-title {
            font-size: 28px;
            color: #212529;
            font-weight: 700;
            letter-spacing: -0.5px;
        }

        /* â”€â”€ PRODUCTS â”€â”€ */
        .products-section {
            padding: 24px 20px 60px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .products-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 24px;
            margin-bottom: 50px;
        }

        .product-card {
            background: white;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 4px 16px rgba(0,0,0,0.06);
            transition: all 0.3s cubic-bezier(0.4,0,0.2,1);
            cursor: pointer;
            border: 1px solid #f0f0f0;
        }

        .product-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 12px 32px rgba(0,0,0,0.12);
            border-color: #e9ecef;
        }

        .product-image {
            width: 100%;
            height: 220px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 80px;
            position: relative;
            overflow: hidden;
        }

        .product-img-tag {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .product-card:hover .product-image {
            background: linear-gradient(135deg, #74b9ff15 0%, #a29bfe15 100%);
        }

        .product-info {
            padding: 20px;
        }

        .product-name {
            font-size: 16px;
            font-weight: 600;
            color: #212529;
            margin-bottom: 6px;
            letter-spacing: -0.3px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .product-date {
            font-size: 12px;
            color: #adb5bd;
            margin-bottom: 14px;
        }

        .product-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .product-price {
            font-size: 17px;
            font-weight: 700;
            background: linear-gradient(135deg, #74b9ff 0%, #a29bfe 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .add-btn {
            background: linear-gradient(135deg, #74b9ff 0%, #a29bfe 100%);
            color: white;
            border: none;
            padding: 10px 16px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            transition: all 0.2s ease;
            box-shadow: 0 4px 12px rgba(116,185,255,0.35);
        }

        .add-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(116,185,255,0.45);
        }

        .add-btn:active {
            transform: translateY(0);
        }

        /* â”€â”€ EMPTY / ERROR STATE â”€â”€ */
        .empty-state {
            grid-column: 1 / -1;
            text-align: center;
            padding: 80px 20px;
            color: #adb5bd;
        }

        .empty-icon {
            font-size: 64px;
            margin-bottom: 16px;
        }

        .empty-state p {
            font-size: 16px;
        }

        /* â”€â”€ SKELETON â”€â”€ */
        .skeleton {
            background: white;
            border-radius: 20px;
            overflow: hidden;
            border: 1px solid #f0f0f0;
        }

        .skeleton-img {
            height: 220px;
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
        }

        .skeleton-body {
            padding: 20px;
        }

        .skeleton-line {
            height: 14px;
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
            border-radius: 6px;
            margin-bottom: 10px;
        }

        .skeleton-line.short  { width: 70%; }
        .skeleton-line.shorter { width: 45%; }

        @keyframes shimmer {
            0%   { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        /* â”€â”€ PAGINATION â”€â”€ */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 6px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .page-btn {
            background: white;
            border: 1px solid #e9ecef;
            color: #495057;
            width: 40px;
            height: 40px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s ease;
        }

        .page-btn.wide {
            width: auto;
            padding: 0 16px;
        }

        .page-btn:hover:not(:disabled) {
            background: linear-gradient(135deg, #74b9ff 0%, #a29bfe 100%);
            color: white;
            border-color: transparent;
            box-shadow: 0 4px 12px rgba(116,185,255,0.35);
        }

        .page-btn.active {
            background: linear-gradient(135deg, #74b9ff 0%, #a29bfe 100%);
            color: white;
            border-color: transparent;
            box-shadow: 0 4px 12px rgba(116,185,255,0.35);
        }

        .page-btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        /* â”€â”€ FOOTER â”€â”€ */
        footer {
            background: #212529;
            color: #adb5bd;
            text-align: center;
            padding: 40px 20px;
            margin-top: 60px;
        }

        footer p {
            margin: 10px 0;
            font-size: 14px;
            line-height: 1.6;
        }

        footer p:first-child {
            color: white;
            font-weight: 600;
            font-size: 15px;
        }

        /* â”€â”€ RESPONSIVE â”€â”€ */
        @media (max-width: 1024px) {
            .products-grid { grid-template-columns: repeat(3, 1fr); }
        }

        @media (max-width: 768px) {
            header { padding: 16px 20px; flex-wrap: wrap; }
            .search-container { order: 3; width: 100%; max-width: 100%; margin-top: 12px; }
            .page-hero { flex-direction: column; gap: 24px; text-align: center; }
            .hero-text h1 { font-size: 26px; }
            .products-grid { grid-template-columns: repeat(2, 1fr); gap: 16px; }
        }
    </style>
</head>
<body>

<!-- â”€â”€â”€â”€â”€â”€â”€â”€â”€ HEADER (home.html ìŠ¤íƒ€ì¼) â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<header>
    <div class="header-inner">
        <a class="logo" onclick="location.href='home.html'">SSAK3</a>

        <div class="header-search">
            <input
                type="text"
                id="searchInput"
                placeholder="ìƒí’ˆì„ ê²€ìƒ‰í•´ë³´ì„¸ìš”"
                onkeypress="handleSearchEnter(event)"
            >
            <button class="header-search-btn" onclick="handleSearch()">ê²€ìƒ‰</button>
        </div>

        <div class="header-nav">
            <a class="navbar-link" onclick="location.href='product-search.html'">ì „ì²´ ìƒí’ˆ</a>
            <a class="navbar-link" onclick="location.href='time-deals.html'">íƒ€ì„ë”œ</a>
            <a class="navbar-link" onclick="location.href='cart.html'">ì¥ë°”êµ¬ë‹ˆ</a>
            <div class="navbar-divider"></div>

            <button class="auth-btn" id="loginBtn" style="display: none;">ë¡œê·¸ì¸ / íšŒì›ê°€ì…</button>

            <div class="user-info" id="userInfo" style="display: none;">
                <a class="navbar-link active" id="myPageBtn">ë§ˆì´í˜ì´ì§€</a>
                <a class="navbar-link" id="logoutBtn" style="color:#ef4444;">ë¡œê·¸ì•„ì›ƒ</a>
            </div>
        </div>
    </div>
</header>

<!-- â”€â”€â”€â”€â”€â”€â”€â”€â”€ CATEGORY NAV â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<nav id="categoryNav"></nav>


<!-- â”€â”€â”€â”€â”€â”€â”€â”€â”€ PAGE HERO â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div class="page-hero">
    <div class="hero-text">
        <h1 id="heroTitle">ì¹´í…Œê³ ë¦¬ ìƒí’ˆ</h1>
        <p id="heroSubtitle">í•´ë‹¹ ì¹´í…Œê³ ë¦¬ì˜ ëª¨ë“  ìƒí’ˆì„ í™•ì¸í•˜ì„¸ìš”</p>
    </div>
    <div class="hero-count">
        <span class="count-num" id="totalCount">-</span>
        <div class="count-label">ê°œì˜ ìƒí’ˆ</div>
    </div>
</div>

<!-- â”€â”€â”€â”€â”€â”€â”€â”€â”€ TOOLBAR â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div class="toolbar">
    <span class="section-title" id="toolbarTitle">ì „ì²´ ìƒí’ˆ</span>
</div>

<!-- â”€â”€â”€â”€â”€â”€â”€â”€â”€ PRODUCTS GRID â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div class="products-section">
    <div class="products-grid" id="productsGrid">
        <!-- ìŠ¤ì¼ˆë ˆí†¤ ë¡œë”© -->
        <div class="skeleton"><div class="skeleton-img"></div><div class="skeleton-body"><div class="skeleton-line"></div><div class="skeleton-line short"></div><div class="skeleton-line shorter"></div></div></div>
        <div class="skeleton"><div class="skeleton-img"></div><div class="skeleton-body"><div class="skeleton-line"></div><div class="skeleton-line short"></div><div class="skeleton-line shorter"></div></div></div>
        <div class="skeleton"><div class="skeleton-img"></div><div class="skeleton-body"><div class="skeleton-line"></div><div class="skeleton-line short"></div><div class="skeleton-line shorter"></div></div></div>
        <div class="skeleton"><div class="skeleton-img"></div><div class="skeleton-body"><div class="skeleton-line"></div><div class="skeleton-line short"></div><div class="skeleton-line shorter"></div></div></div>
        <div class="skeleton"><div class="skeleton-img"></div><div class="skeleton-body"><div class="skeleton-line"></div><div class="skeleton-line short"></div><div class="skeleton-line shorter"></div></div></div>
    </div>

    <!-- í˜ì´ì§€ë„¤ì´ì…˜ -->
    <div class="pagination" id="pagination"></div>
</div>

<!-- â”€â”€â”€â”€â”€â”€â”€â”€â”€ FOOTER â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<footer>
    <p>Â© 2026 ì‹¹ì“°ë¦¬ - ëª¨ë‘ë¥¼ ìœ„í•œ ê·€ì—¬ìš´ êµ¿ì¦ˆ</p>
    <p>ê³ ê°ì„¼í„°: 010-1234-5678 | <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="adcec2c3d9ccced9eddedeccc69e83cec2c0">[email&#160;protected]</a></p>
    <p>ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨ | ì´ìš©ì•½ê´€ | ë°°ì†¡ì •ì±…</p>
</footer>

<script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script>
<script>
    // API URL ì„¤ì •
    const API_URL = (() => {
        const hostname = window.location.hostname;

        if (hostname === 'localhost' || hostname === '127.0.0.1') {
            return 'http://localhost:8080';
        }

        if (hostname === 'admin.ssak3.store') {
            return 'https://admin.ssak3.store';
        }

        return 'https://ssak3.store';
    })();

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€ URL íŒŒë¼ë¯¸í„° íŒŒì‹± â”€â”€â”€â”€â”€â”€â”€â”€â”€
    const urlParams = new URLSearchParams(window.location.search);
    const categoryId = urlParams.get('categoryId');
    let currentPage = parseInt(urlParams.get('page') || '0');

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€ ì¹´í…Œê³ ë¦¬ ëª©ë¡ ë¡œë“œ + ë„¤ë¹„ í™œì„±í™” â”€â”€â”€â”€â”€â”€â”€â”€â”€
    async function loadCategories() {
        try {
            const res = await fetch(`${API_URL}/ssak3/categories`);
            const result = await res.json();
            if (!result.success) return;

            const categories = result.data.content || result.data;
            const nav = document.getElementById('categoryNav');

            categories.forEach(cat => {
                const a = document.createElement('a');
                a.textContent = cat.name;
                a.href = `category-product.html?categoryId=${cat.id}`;

                // í˜„ì¬ í˜ì´ì§€ì™€ ê°™ì€ ì¹´í…Œê³ ë¦¬ë©´ active
                if (String(cat.id) === String(categoryId)) {
                    a.classList.add('active');
                    // hero / toolbar ì œëª© ì—…ë°ì´íŠ¸
                    document.getElementById('heroTitle').textContent = `${cat.name} ìƒí’ˆ`;
                    document.getElementById('heroSubtitle').textContent = `${cat.name} ì¹´í…Œê³ ë¦¬ì˜ ëª¨ë“  ìƒí’ˆì„ í™•ì¸í•˜ì„¸ìš”`;
                    document.getElementById('toolbarTitle').textContent = cat.name;
                    document.title = `${cat.name} - ì‹¹ì“°ë¦¬`;
                }

                nav.appendChild(a);
            });
        } catch (e) {
            console.error('ì¹´í…Œê³ ë¦¬ ë¡œë”© ì‹¤íŒ¨:', e);
        }
    }

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€ ìƒí’ˆ ëª©ë¡ ë¡œë“œ â”€â”€â”€â”€â”€â”€â”€â”€â”€
    async function loadProducts(page = 0) {
        // categoryId ì—†ìœ¼ë©´ ì˜ëª»ëœ ì ‘ê·¼
        if (!categoryId) {
            renderError('ì¹´í…Œê³ ë¦¬ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤. í™ˆì—ì„œ ì¹´í…Œê³ ë¦¬ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
            return;
        }

        const params = new URLSearchParams({
            categoryId,
            page,
            size : 10
        });

        const grid = document.getElementById('productsGrid');

        try {
            const res = await fetch(`${API_URL}/ssak3/products?${params}`);
            const result = await res.json();

            if (!result.success) {
                renderError(result.message || 'ìƒí’ˆì„ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.');
                return;
            }

            // ì‘ë‹µì´ Page ê°ì²´ì¸ ê²½ìš°ì™€ ë‹¨ìˆœ ë°°ì—´ì¸ ê²½ìš° ëª¨ë‘ ì²˜ë¦¬
            const isPage = result.data && result.data.content !== undefined;
            const products = isPage ? result.data.content : result.data;
            const totalElements = isPage ? result.data.totalElements : products.length;
            const totalPages = isPage ? result.data.totalPages : 1;

            // ì´ ê°œìˆ˜ í‘œì‹œ
            document.getElementById('totalCount').textContent = totalElements.toLocaleString();

            grid.innerHTML = '';

            if (!products || products.length === 0) {
                grid.innerHTML = `
 <div class="empty-state">
 <div class="empty-icon">ğŸ›ï¸</div>
 <p>ì´ ì¹´í…Œê³ ë¦¬ì— ë“±ë¡ëœ ìƒí’ˆì´ ì—†ìŠµë‹ˆë‹¤.</p>
 </div>`;
                document.getElementById('pagination').innerHTML = '';
                return;
            }

            products.forEach((product, i) => {
                const card = createProductCard(product, i);
                grid.appendChild(card);
            });

            renderPagination(page, totalPages);

        } catch (e) {
            console.error('ìƒí’ˆ ë¡œë”© ì‹¤íŒ¨:', e);
            renderError('ì„œë²„ì™€ í†µì‹  ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        }
    }

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€ ìƒí’ˆ ì¹´ë“œ ìƒì„± â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function createProductCard(product, index) {
        const card = document.createElement('div');
        card.className = 'product-card';
        card.style.animationDelay = `${index * 0.05}s`;

        const formattedDate = product.createdAt
            ? new Date(product.createdAt).toLocaleDateString('ko-KR', { year:'numeric', month:'short', day:'numeric' })
            : '';

        const displayPrice = (product.dealPrice ?? product.price ?? 0).toLocaleString();

        let imageContent;
        if (product.imageUrl) {
            imageContent = `<img class="product-img-tag" src="${product.imageUrl}" alt="${product.name}" onerror="this.style.display='none';this.nextElementSibling.style.display='flex'">
<div style="display:none;width:100%;height:100%;align-items:center;justify-content:center;font-size:64px;">ğŸ›ï¸</div>`;
        } else {
            imageContent = `<span>ğŸ›ï¸</span>`;
        }

        card.innerHTML = `
<div class="product-image">${imageContent}</div>
<div class="product-info">
<div class="product-name" title="${product.name}">${product.name}</div>
<div class="product-footer">
<div class="product-price">${displayPrice}ì›</div>

</div>
</div>`;

        // ì¹´ë“œ í´ë¦­ â†’ ìƒì„¸ í˜ì´ì§€
        card.addEventListener('click', () => {
            window.location.href = `product-detail.html?id=${product.id}`;
        });

        return card;
    }

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€ ì—ëŸ¬ í‘œì‹œ â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function renderError(msg) {
        document.getElementById('productsGrid').innerHTML = `
<div class="empty-state">
<div class="empty-icon">âš ï¸</div>
<p>${msg}</p>
</div>`;
        document.getElementById('totalCount').textContent = '0';
    }

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€ í˜ì´ì§€ë„¤ì´ì…˜ ë Œë” â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function renderPagination(current, total) {
        const pag = document.getElementById('pagination');
        if (total <= 1) { pag.innerHTML = ''; return; }

        const range = 2;// í˜„ì¬ í˜ì´ì§€ ì•ë’¤ í‘œì‹œ ë²”ìœ„
        let html = '';
        const mkBtn = (page, label, cls = '') =>
            `<button class="page-btn ${cls}" onclick="goPage(${page})">${label}</button>`;

        // ì´ì „
        html += `<button class="page-btn wide" ${current === 0 ? 'disabled' : ''} onclick="goPage(${current - 1})">â—€ ì´ì „</button>`;

        // ì²« í˜ì´ì§€
        if (current - range > 0) {
            html += mkBtn(0, 1);
            if (current - range > 1) html += `<span style="padding:0 4px;color:#adb5bd;">â€¦</span>`;
        }

        // í˜ì´ì§€ ë²ˆí˜¸
        for (let i = Math.max(0, current - range); i <= Math.min(total - 1, current + range); i++) {
            html += mkBtn(i, i + 1, i === current ? 'active' : '');
        }

        // ë§ˆì§€ë§‰ í˜ì´ì§€
        if (current + range < total - 1) {
            if (current + range < total - 2) html += `<span style="padding:0 4px;color:#adb5bd;">â€¦</span>`;
            html += mkBtn(total - 1, total);
        }

        // ë‹¤ìŒ
        html += `<button class="page-btn wide" ${current === total - 1 ? 'disabled' : ''} onclick="goPage(${current + 1})">ë‹¤ìŒ â–¶</button>`;

        pag.innerHTML = html;
    }

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€ í˜ì´ì§€ ì´ë™ â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function goPage(page) {
        currentPage = page;
        window.scrollTo({ top: 0, behavior: 'smooth' });
        loadProducts(page);

        // URLë„ ì—…ë°ì´íŠ¸ (ë’¤ë¡œê°€ê¸° ëŒ€ì‘)
        const url = new URL(window.location);
        url.searchParams.set('page', page);
        window.history.pushState({}, '', url);

    }

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€ ê²€ìƒ‰ â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function handleSearch() {
        const keyword = document.getElementById('searchInput').value.trim();
        window.location.href = keyword
            ? `product-search.html?keyword=${encodeURIComponent(keyword)}&page=0`
            : 'product-search.html';
    }

    function handleSearchEnter(e) {
        if (e.key === 'Enter') handleSearch();
    }

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€ ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸ â”€â”€â”€â”€â”€â”€â”€â”€â”€
    async function checkLoginStatus() {
        const loginBtn = document.getElementById('loginBtn');
        const userInfo = document.getElementById('userInfo');
        const token = localStorage.getItem('accessToken');

        try {
            let response;
            if (token) {
                response = await fetch(`${API_URL}/ssak3/users/me`, {
                    method: 'GET',
                    headers: { 'Authorization': `Bearer ${token}` }
                });
            }
            if (!token || response.status === 401) {
                response = await fetch(`${API_URL}/ssak3/users/me`, {
                    method: 'GET', credentials: 'include'
                });
            }
            if (response.ok) {
                loginBtn.style.display = 'none';
                userInfo.style.display = 'flex';
            } else throw new Error('Not Authenticated');
        } catch {
            localStorage.removeItem('accessToken');
            loginBtn.style.display = 'block';
            userInfo.style.display = 'none';
        }
    }

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€ ë¡œê·¸ì•„ì›ƒ â”€â”€â”€â”€â”€â”€â”€â”€â”€
    document.getElementById('logoutBtn').addEventListener('click', async () => {
        if (!confirm('ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
        const token = localStorage.getItem('accessToken');
        try {
            const req = { method: 'POST', credentials: 'include' };
            if (token) req.headers = { 'Authorization': `Bearer ${token}` };
            await fetch(`${API_URL}/ssak3/auth/logout`, req);
        } catch (e) {
            console.error('ë¡œê·¸ì•„ì›ƒ í†µì‹  ì—ëŸ¬:', e);
        } finally {
            localStorage.removeItem('accessToken');
            alert('ë¡œê·¸ì•„ì›ƒ ë˜ì—ˆìŠµë‹ˆë‹¤.');
            window.location.href = 'home.html';
        }
    });

    document.getElementById('loginBtn').addEventListener('click', () => location.href = 'login.html');
    document.getElementById('myPageBtn').addEventListener('click', () => {
        location.href = 'mypage.html';
    });

    // â”€â”€â”€â”€â”€â”€â”€â”€â”€ í˜ì´ì§€ ì´ˆê¸°í™” (ë§¤ìš° ì¤‘ìš”!) â”€â”€â”€â”€â”€â”€â”€â”€â”€
    window.addEventListener('DOMContentLoaded', () => {
        // 1. ì¹´í…Œê³ ë¦¬ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
        loadCategories();

        // 2. í˜„ì¬ URLì˜ page íŒŒë¼ë¯¸í„°ì— ë§ëŠ” ìƒí’ˆ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
        loadProducts(currentPage);

        // 3. ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸í•˜ì—¬ í—¤ë” UI ë³€ê²½
        checkLoginStatus();
    });
</script>
</body>
</html>